\chapter{Introduction}
\label{chap:Introduction}
%\input{./Introduction/Background/Background.tex}
%\input{./Introduction/Bibliographic_Revision/Bibliographic_Revision.tex}
%\input{./Introduction/Purpose/Purpose.tex}
%\input{./Introduction/Delimitations/Delimitations.tex}

\section{Background}

The Mechatronics Research group at Simon Bolivar University in Caracas, Venezuela is focused on the development of solutions based on the integration of knowledge in the fields of Automatic Control, Computer Science, AI and Robotics, Electronics and Mechanics. This development is made on a project based strategy, with projects coming from both industry and academia. One of the projects is focused on the development of underwater inspection using the underwater robot developed in the group called PoseiBot. The development of this underwater robotic platform has been made in several phases through the years. In the latest phase, a Model Predictive Control (MPC) strategy was implemented by Molero et al. \cite{Molero2011} to control the submarine in order to achieve accuracy control in PoseiBot in terms of the control effort, error reduction and robustness. MPC is an advanced control technique based on solving an optimal control problem with a finite prediction horizon in each iteration. MPC is commonly applied to large systems with slow dynamics, but recently with the increase of computational power and the development of new algorithms that are more efficient, systems with faster dynamics are being targeted to be controlled by predictive methods. This was implemented through communication of PoseiBot's microcontroller to a remote computer out of the water using serial wired communication to a flotation device that communicates wirelessly with the remote computer. In the computer, signal acquisition  and data processing was done via LabVIEW \texttrademark  and MATLAB\textsuperscript{\textregistered}, respectively. \\

Another project developed in the group is the usage of helicopter models as a robotic platform for powerline inspection. Due to the wind conditions around the powerlines to be inspected, a robust control algorithm is required to assure a safe operation of the quadrotor while maneuvering around the lines. There is a strong interest on using instead the quadrotor available in the research group instead of the helicopter because of the increased stability. \\

Based on the requirements set by the aforementioned projects, there has been an increasing interest in advanced control techniques and specially MPC applications for both platforms. MPC has been proven as an efficient tool for solving multivariable control problems that might be difficult to decouple in plants that might have restrictions in the variables and might even be nonlinear. MPC can handle all of these requirements satisfactorily while being optimal in the solution, which is important in cases where resources are limited.\\




But in order to provide a solution that could fit both applications in a relatively quick way, some standardization and abstraction is required in the solution. That is where the benefits of using ROS apply, and it also represented an opportunity to extend the usage of this tool within the group.


\section{Purpose}

The purpose of this project is the creation of a ROS package to implement in a standard and abstract way MPC strategies in different platforms . The standard characteristic is necessary to get a package that is easy to use without needing to know how it works internally. The abstraction required comes from the fact that the software must work equally good independently of the platform that is being controlled. Of course, there are limitations on how much abstraction can be obtained, since every application will require the development of a process model for the package to use. However, the goal is to use the properties of ROS to achieve this.\\

To reach this goal, the first activity to do will be an extensive bibliographic revision about MPC and its varieties, either theoretically and implemented in different systems. Another topic included in this revision is quadratic programming, since the interest is to apply MPC with constraints. When the MPC problem is not constrained the control law can be calculated exactly, but when constraints are added the solution must be obtained numerically, and there is when quadratic programs arise. This happens for linear systems and/or linearized systems, which are the object of interest in this phase of the project.\\

After this phase, the focus will be the design of the organization and development of the package. This is an important phase of the project because a proper design will allow a modular organization of the functionality, i.e. the nodes in the package will be enabled to be used in different combinations without altering the way the software works. The development is carried out in an iterative way, so the code can be tested and improved in each iteration. \\

The third phase consists in the creation of a demonstrative platform to use it as an overall test for the package. This includes the creation of a Model and Simulator classes for such system. The model used is kept simple to ease the validation of the results. The chosen system for this purpose is a water recirculation system with two tanks, that is used in the Automatic Control courses. This will save the modeling work, since this is a well-known plant. \\

At this point, the MPC package will be already running properly, and then the time to try it in a relevant platform comes. The modeling of the quadrotor platform will be performed to use it with the MPC package and perform simulated tests in trajectories of interest. This phase may require several tests in order to characterize and obtain the properties of the quadrotor if there is no relevant work available about it. The model also requires a validation process for itself to prove that it works in an adequate manner. 

\section{Bibliographic Revision}

Even though MPC has been proven since long time ago to be applicable for different types of plants and processes, it took some time until the industry embraced it as the powerful tool it is. One of the first attemps to show the pros and cons of MPC is described  by Richalet in \cite{Richalet1993}. In this paper, the benefits of implementing MPC are addressed from an industrial point of view, as well as the differences in the approach required to apply it in a proper way. The diversity of applications for MPC is also a topic in this paper: two cases are conducted, one with slow dynamics systems and one in a system with quick dynamics; being able to handle both satisfactorily. An important conclusion from this paper is that the difference in application compared to traditional control techniques is that the effort is centered on the development of the model, not in the tuning of the controller. If a proper model is developed, the tuning of the controller consists on a proper choice of the horizons and weight matrices. On the other side, this requires a higher level of training for the staff in charge of the system.\\

In order to take advantage of this new engineering approach for the application of this technique, there have been several attempts to provide a platform to ease the control and focus on the modeling work. Most implementations in research are implemented using MATLAB\textsuperscript{\textregistered} as in \cite{Gabrielsson2012}, \cite{Molero2011}, \cite{Kristoffersson2006} and \cite{Johansson2012} to mention some examples.\\

In \cite{Gabrielsson2012}, a linear MPC strategy is used to provide a system of water dams an adequate flow of water required for the paper mills while maintaining the water levels among some defined boundaries and optimizing the use of it. In this thesis report it is easy to see practically the point that was made before: a good part of the work is done in the development of a suitable model, afterwards the tuning of the MPC strategy is reduced to the tuning of the weight matrices, the prediction and control horizons and the size of the control time step. The MPC technique in this report is performed in MATLAB \textsuperscript{\textregistered}, using a quadratic cost function and state estimation via Kalman. In this case, the system dynamics are not so fast, so the computational power provided by MATLAB \textsuperscript{\textregistered} is enough to solve the problem within the sampling time restrictions.\\

In \cite{Molero2011}, the problem to solve is the trajectory tracking of a underwater ROV. In this case, the MPC formulation used is a particular one because the constraints in the control and state variables are translated to the cost function directly using penalty functions. In this way, each constraint has a penalty cost associated that goes into the objective function. The implementation used a combination of wired and wireless technology for the data sending/receiving process, which was sent to a remote computer performing the MPC calculations and sending back the control signals to the ROV. The data processing was done in MATLAB \textsuperscript{\textregistered}, and the acquisition and GUI was done in LabVIEW \texttrademark. Using this strategy, substantial improvements in comparison with traditional PID strategies were obtained in tracking performance and control effort.\\

In \cite{Kristoffersson2006}, MPC is used to control a turbocharged diesel engine. Several models are used to get the predictions: one simple linear model which lead to very good results; and a linear model evaluated in several operation points, forty five (45) to be precise. This switching of linear models makes it difficult to assure stability between operation points. To get a good performance, integral action was required.\\

In \cite{Johansson2012}, ACADO is used to implement a MPC in a submarine ROV model. ACADO is a toolkit for automatic control and dynamic optimization. However, in this report a successful implementation of the MPC using this toolkit was not achieved, therefore a simulated MPC was implemented using Simulink \textsuperscript{\textregistered}. The linearized models of the submarine were shown to not be enough for a proper trajectory tracking, specially when going far from the operation points. In this thesis, it is to highlight the use of ROS for communication purposes, particularly to use the drivers developed for the XBox controller to add them to the teleoperation system. This is one of several advantages of using ROS for these purposes: open source code reuse to ease the addition of hardware to the system.\\

One disadvantage of MPC implementations using MATLAB \textsuperscript{\textregistered} and Simulink \textsuperscript{\textregistered} is that in cases where it is applied in unmanned vehicles, it makes the platform dependant on the communication with a remote computer. When applied in mobile autonomous platforms, the usual way used to perform the calculations is via C/C++ code deployed in single board computers. When this is done, it is even more convenient to have a way to reuse code for different MPC applications and focus more on obtaining a good model, and the later tuning required. The following papers have been focused on finding the way to make a standard MPC implementation for these cases. \\

In \cite{Manenti2008}, the approach was to create a generalized class to solve MPC and dynamic optimization problems, using the \emph{BzzMath} library to perform the calculations of the differential equations that describe the models. To use the class, the user must define only the differential system defined in the model and the objective function required to minimize, avoiding any struggle with numerical issues with the integration of the differential system and/or the minimization process. The class is designed for C++, but it has support for FORTRAN users as well. The inner architecture of the class is built in a intuitive way: the differential system provides information to the objective function, which is user defined and also accepts economical scenarios in case they are required. The combination of the model, the configurations and the economical scenarios combine altogether in the objective function. Then this objective function is passed to an optimization algorithm which minimizes the objective function and provides the results. However, depending on the application, trying different optimization algorithms or differential solvers might be of interest, and these parameters are not customizable if this class is used.\\

In \cite{Rosendo2009} the aforementioned interest in being able to customize the MPC problem was addressed. The approach taken here is towards the same goal, but instead of providing a generalized class, the proposal is to provide a whole library to deal with the different scenarios when formulating an MPC problem, and exploting the properties of Object Oriented Programming (OOP) to easily change the classes in the structure to fit the required problem. For example, the different varieties of linear models are dealt with by means of inheritance, where each type of linear model class inherits its properties from the base linear model class, easing the implementation and adding specific functionality tailored for each kind of model in particular. The library is based on the donlp2 solver, but there are ways to add another solver. This allows to customize the MPC and use the solver and model that fits best to each particular case. \\

Regarding the modeling of the quadrotor, there has been a lot of work done previously on this kind of platform in modeling and in control techniques applied to it \cite{Bouabdallah2004},  \cite{Bresciani2008}, \cite{Lellis}, \cite{Raffo2007}, \cite{Salih2010}, \cite{YueSun2012} and \cite{MahoneyKumarCorke2012}. Most of the master thesis reports studied had the same goal in common: modeling, identification and control of the quadrotor platform. Therefore, the modeling work done was straightforward and the identification of parameters was taken from previous reports. The control techniques applied in most of these reports are classic PID structures, since the control is one of three major activities of the content, however in \cite{Alexis2011} a switching MPC approach is taken using several linearized models around different operation points. The switching is ruled by the Roll and Pitch angles, and the system is constrained to operate in a certain range of angles that define the operation points. This implementation uses an optical flow device to estimate the planar motion movements, then the velocities in the $XY$ plane are estimated through a couple of 2 state Extended Kalman Filters. The system is proven to be able to perform very well in indoor conditions.\\

In \cite{Bouffard2012} the MPC strategy is extended by means of adaptive or learning techniques that improve the model of the system continuosly using online data. The performance of the model is included in the cost function bounded by a nominal model, and includes a modeling error in the optimization constraints. The advantage of this is that even in the learning algorithm fails and the model is not improved, the system is kept within safety limits because of its inclusion in the cost function. The outcome of this work is remarkable, as the updating of the model is fast enough to allow the quadrotor to perform meaningful tasks that require speed and precision, in this case, catching a ball.

\section{Thesis Outline}

In the Introduction, the context of the project is presented, where the objectives of this project are defined and the state-of-the-art in the corresponding fields of knowledge are presented. In Chapter 2, titled Model Predictive Control, a review of this advanced control method is introduced and specific information about each element that is involved in MPC is described. In Chapter 3, the theoretical foundation used to develop a model for the quadrotor platform is described, and the implementation of the model is performed and validated. In Chapter 4, the proposed library is described in detail: how it is organized, what does it include or not, what can be done with it and how does it work. Chapter 5 presents the results of testing in the two different simulated systems that were developed, Chapter 6 contains the conclusions derived from this thesis and Chapter 7 indicates the recommendations and/or future work efforts to be made with this project.  

 	




 
